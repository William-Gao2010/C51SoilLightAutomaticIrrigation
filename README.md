# STC8G 多功能控制程序

本项目基于 **STC8G 单片机**，实现了以下功能模块：
- **UART 串口通信**：用于数据调试与传输。
- **LCD1602 显示**：显示欢迎信息、工作状态及光照检测结果。
- **光敏检测模块**：通过 ADC 采集光照强度并传输到串口。
- **舵机 (SG90) 控制**：利用定时器 PWM 实现 0°~90° 舵机角度控制。
- **多任务状态机**：在 `main()` 循环中轮询 Home 状态，根据光照自动触发舵机工作。

---

## 功能结构

### 1. 串口通信 (UART)
- **波特率**：9600bps @ 33.1776MHz。
- **中断处理**：`Uart1()` 负责 TI 和 RI 的清除。
- **发送数据**：`SendData(int Data)` 可将 ADC 结果或状态信息输出。

### 2. LCD1602 显示
- **初始化**：`LCDstart()` 配置 1602 模式。
- **欢迎界面**：`Welcome()` 显示启动欢迎信息。
- **主页显示**：`Home()` 显示光照强度与工作状态。

### 3. 光敏检测
- **ADC 配置**：`CheckLight()` 通过 STC8G 的 `ADC_CONTR` 等寄存器完成采样。
- **数据处理**：`conversion()` 将高低字节组合为 10 位结果。

### 4. 舵机 PWM 控制
- **PWM 实现**：`Timer0()` 中断函数以 100us 定时周期产生 PWM。
- **角度调节**：`pmw_degree(unsigned char degree)` 通过映射函数 `degreecount()` 将角度转为脉宽。

### 5. 主要流程
- **main()** 初始化所有模块后进入循环：
  - 调用 `Home()` 进行 LCD 更新与光敏检测；
  - 当光照低于阈值时触发 `DJWork()`，舵机自动工作，并更新状态显示。

---

## 代码结构

- **入口函数**：`main()`
- **中断函数**：
  - `Timer0()`：PWM 驱动 SG90 舵机。
  - `Uart1()`：串口收发中断处理。
- **外设驱动函数**：
  - `Uart1_Init()`：UART 初始化。
  - `Timer0_Init()`：定时器0初始化。
  - `LCDstart()`、`write_data()`、`write_introduce()`：LCD 驱动。
  - `CheckLight()`：光敏检测与 ADC 采集。

---

## 使用方法

1. 使用 **Keil uVision** 打开项目并编译代码。
2. 烧录至 **STC8G 系列单片机**。
3. 通过串口助手查看光敏传感器的实时输出值。
4. 通过 LCD1602 查看系统状态与舵机角度。

---

## 联系方式

**版权所有：WilliamGao**  
**邮箱：17156310913ghj@gmail.com**

